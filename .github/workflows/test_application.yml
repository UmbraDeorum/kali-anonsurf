name: Test AnonSurf Behavior on kali-rolling

on:
  pull_request: # Trigger on all pull requests
    branches:
      - '**' # All branches for pull requests
  push: # Trigger on pushes to specific branches
    branches:
      - master # Only on merges to master

jobs:
  test-script:
    runs-on: ubuntu-latest
    container:
      image: kalilinux/kali-rolling:latest  # Use a Kali Linux environment

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Update packages and install dependencies
      run: |
        export DEBIAN_FRONTEND=noninteractive
        apt-get update
        apt-get install -y ca-certificates curl bleachbit tor iptables

    - name: Test AnonSurf IPv6 Handling
      run: |
        anonsurf start

        echo "Testing if IPv6 is disabled..."
        if [ "$(sysctl net.ipv6.conf.all.disable_ipv6 | awk '{print $3}')" != "1" ]; then
          echo "ERROR: IPv6 is not disabled!"
          anonsurf stop
          exit 1
        fi
        echo "IPv6 is successfully disabled."

        echo "Stopping AnonSurf and restoring network configuration..."
        anonsurf stop
